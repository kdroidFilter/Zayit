<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>Download Zayit - Jewish Study Library</title>
    <meta name="description" content="Download Zayit for Windows, macOS, and Linux. Free Jewish study library application.">
    
    <link rel="icon" type="image/png" href="images/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/svg+xml" href="images/favicon.svg">
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <!-- Title Bar -->
    <header class="title-bar">
        <div class="title-bar-container">
            <div style="display: flex; align-items: center; gap: 1rem;">
                <a href="index.html" class="title-bar-logo">
                    <img src="images/icon.png" alt="Zayit">
                    <span>Zayit</span>
                </a>
            </div>

            <div class="title-bar-controls">
                <a href="https://github.com/kdroidFilter/SeforimApp" target="_blank" rel="noopener noreferrer" class="title-bar-button source-button">
                    <svg class="icon-sm">
                        <use href="images/icons.svg#github"></use>
                    </svg>
                    <span class="en-text">Source</span>
                    <span class="he-text hidden">קוד</span>
                </a>
                <a href="https://ko-fi.com/lomityaesh" target="_blank" rel="noopener noreferrer" class="title-bar-button support-button">
                    <svg class="icon-sm">
                        <use href="images/icons.svg#coffee"></use>
                    </svg>
                    <span class="en-text">Support</span>
                    <span class="he-text hidden">תמיכה</span>
                </a>
                <button class="title-bar-button theme-toggle" onclick="toggleTheme()" aria-label="Toggle theme">
                    <svg class="icon theme-icon-light">
                        <use href="images/icons.svg#sun"></use>
                    </svg>
                    <svg class="icon theme-icon-dark hidden">
                        <use href="images/icons.svg#moon"></use>
                    </svg>
                </button>
                <button class="title-bar-button lang-toggle" onclick="toggleLanguage()" id="langToggle">
                    ע
                </button>
                <a href="index.html" class="title-bar-button">
                    <svg class="icon-sm">
                        <use href="images/icons.svg#arrow-left"></use>
                    </svg>
                    <span class="en-text">Back</span>
                    <span class="he-text hidden">חזרה</span>
                </a>
            </div>
        </div>
    </header>

    <!-- Compact Download Section -->
    <main class="download-main">
        <div class="download-container">
            <h1 class="download-title">
                <span class="en-text">Download Zayit</span>
                <span class="he-text hidden">הורדת זית</span>
            </h1>
            
            <p class="download-description">
                <span class="en-text">Your digital study hall awaits. Fast, reliable, and completely free.</span>
                <span class="he-text hidden">בית המדרש הדיגיטלי שלכם מחכה. מהיר, אמין וחינמי לחלוטין.</span>
            </p>
            
            <div class="download-stats">
                <span class="stat-item">6,800+ <span class="en-text">Books</span><span class="he-text hidden">ספרים</span></span>
                <span class="stat-item">100% <span class="en-text">Offline</span><span class="he-text hidden">אופליין</span></span>
                <span class="stat-item" id="downloadStats"><!-- Download count --></span>
            </div>
            
            <!-- System Detection -->
            <div class="system-detection">
                <span class="detected-system" id="detectedSystem">Detecting platform...</span>
            </div>

            <!-- Main Download -->
            <div class="main-download">
                <a href="#" class="download-btn main" id="mainDownloadBtn">
                    <svg class="icon-sm">
                        <use href="images/icons.svg#download"></use>
                    </svg>
                    <span class="download-text">
                        <span class="filename" id="mainFilename">Loading...</span>
                    </span>
                </a>
            </div>

            <!-- Alternative Options -->
            <div class="alternative-options">
                <button class="expand-toggle" onclick="toggleAlternatives()">
                    <span class="en-text">More options</span>
                    <span class="he-text hidden">אפשרויות נוספות</span>
                    <svg class="icon-sm chevron-icon">
                        <use href="images/icons.svg#chevron-down"></use>
                    </svg>
                </button>
                
                <div class="alternatives-content" id="alternativesContent">
                    <a href="downloads/windows/Zayit-0.4.5_x64.msi" class="download-btn alt">
                        <svg class="icon-sm">
                            <use href="images/icons.svg#download"></use>
                        </svg>
                        <span class="download-text">
                            <span class="filename">Zayit-0.4.5_x64.msi</span>
                            <span class="filesize">137 MB</span>
                        </span>
                    </a>
                    <a href="downloads/windows/Zayit-0.4.5_arm64.exe" class="download-btn alt">
                        <svg class="icon-sm">
                            <use href="images/icons.svg#download"></use>
                        </svg>
                        <span class="download-text">
                            <span class="filename">Zayit-0.4.5_arm64.exe</span>
                            <span class="filesize">135 MB</span>
                        </span>
                    </a>
                    <a href="downloads/windows/Zayit-0.4.5_arm64.msi" class="download-btn alt">
                        <svg class="icon-sm">
                            <use href="images/icons.svg#download"></use>
                        </svg>
                        <span class="download-text">
                            <span class="filename">Zayit-0.4.5_arm64.msi</span>
                            <span class="filesize">134 MB</span>
                        </span>
                    </a>
                </div>
            </div>

            <!-- Other Platforms -->
            <div class="other-platforms">
                <button class="expand-toggle" onclick="togglePlatforms()">
                    <span class="en-text">Other platforms</span>
                    <span class="he-text hidden">פלטפורמות אחרות</span>
                    <svg class="icon-sm chevron-icon">
                        <use href="images/icons.svg#chevron-down"></use>
                    </svg>
                </button>
                
                <div class="platforms-content" id="platformsContent">
                    <a href="downloads/macos/Zayit-0.4.5_universal.dmg" class="download-btn alt">
                        <svg class="icon-sm">
                            <use href="images/icons.svg#download"></use>
                        </svg>
                        <span class="download-text">
                            <span class="filename">Zayit-0.4.5_universal.dmg</span>
                            <span class="filesize">142 MB • macOS</span>
                        </span>
                    </a>
                    <a href="downloads/linux/Zayit-0.4.5_amd64.deb" class="download-btn alt">
                        <svg class="icon-sm">
                            <use href="images/icons.svg#download"></use>
                        </svg>
                        <span class="download-text">
                            <span class="filename">Zayit-0.4.5_amd64.deb</span>
                            <span class="filesize">139 MB • Linux</span>
                        </span>
                    </a>
                    <a href="downloads/linux/Zayit-0.4.5_x86_64.rpm" class="download-btn alt">
                        <svg class="icon-sm">
                            <use href="images/icons.svg#download"></use>
                        </svg>
                        <span class="download-text">
                            <span class="filename">Zayit-0.4.5_x86_64.rpm</span>
                            <span class="filesize">140 MB • Linux</span>
                        </span>
                    </a>
                </div>
            </div>

            <!-- Database Files -->
            <div class="database-section">
                <button class="expand-toggle" onclick="toggleDatabase()">
                    <span class="en-text">Offline database</span>
                    <span class="he-text hidden">מסד נתונים אופליין</span>
                    <svg class="icon-sm chevron-icon">
                        <use href="images/icons.svg#chevron-down"></use>
                    </svg>
                </button>
                
                <div class="database-content" id="databaseContent">
                    <a href="downloads/database/Zayit-Database-v0.4.5.zip" class="download-btn alt">
                        <svg class="icon-sm">
                            <use href="images/icons.svg#download"></use>
                        </svg>
                        <span class="download-text">
                            <span class="filename">Zayit-Database-v0.4.5.zip</span>
                            <span class="filesize">2.1 GB</span>
                        </span>
                    </a>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Platform detection
        function detectPlatform() {
            const userAgent = navigator.userAgent.toLowerCase();
            const platform = navigator.platform.toLowerCase();
            
            let os = 'windows';
            let arch = 'x64';
            let filename = '';
            let href = '';
            let size = '';
            let displayName = '';
            
            // Detect OS
            if (userAgent.includes('mac') || platform.includes('mac')) {
                os = 'macos';
                filename = 'Zayit-0.4.5_universal.dmg';
                href = 'downloads/macos/Zayit-0.4.5_universal.dmg';
                size = '142 MB';
                displayName = 'macOS Universal';
            } else if (userAgent.includes('linux') || platform.includes('linux')) {
                os = 'linux';
                filename = 'Zayit-0.4.5_amd64.deb';
                href = 'downloads/linux/Zayit-0.4.5_amd64.deb';
                size = '139 MB';
                displayName = 'Linux x64';
            } else {
                // Windows (default)
                os = 'windows';
                
                // Detect architecture for Windows
                if (userAgent.includes('arm') || userAgent.includes('aarch64')) {
                    arch = 'arm64';
                    filename = 'Zayit-0.4.5_arm64.exe';
                    href = 'downloads/windows/Zayit-0.4.5_arm64.exe';
                    size = '135 MB';
                    displayName = 'Windows ARM64';
                } else {
                    arch = 'x64';
                    filename = 'Zayit-0.4.5_x64.exe';
                    href = 'downloads/windows/Zayit-0.4.5_x64.exe';
                    size = '138 MB';
                    displayName = 'Windows x64';
                }
            }
            
            return { os, arch, filename, href, size, displayName };
        }
        
        function updateDownloadUI() {
            const platform = detectPlatform();
            
            // Update system detection
            const detectedSystem = document.getElementById('detectedSystem');
            if (detectedSystem) {
                detectedSystem.textContent = `${platform.displayName} • v0.4.5 • ${platform.size}`;
            }
            
            // Update main download button
            const mainDownloadBtn = document.getElementById('mainDownloadBtn');
            const mainFilename = document.getElementById('mainFilename');
            
            if (mainDownloadBtn && mainFilename) {
                mainDownloadBtn.href = platform.href;
                mainFilename.textContent = platform.filename;
            }
        }

        let isDark = localStorage.getItem('theme') === 'light' ? false : 
                    (localStorage.getItem('theme') === 'dark' || !localStorage.getItem('theme') || window.matchMedia('(prefers-color-scheme: dark)').matches);
        
        let isHebrew = localStorage.getItem('language') === 'he' || 
                      (localStorage.getItem('language') === 'en' ? false : 
                       (navigator.language.startsWith('he') || navigator.languages.some(lang => lang.startsWith('he'))));

        function applyTheme() {
            if (isDark) {
                document.documentElement.classList.add('dark');
                document.querySelector('.theme-icon-light').classList.add('hidden');
                document.querySelector('.theme-icon-dark').classList.remove('hidden');
            } else {
                document.documentElement.classList.remove('dark');
                document.querySelector('.theme-icon-light').classList.remove('hidden');
                document.querySelector('.theme-icon-dark').classList.add('hidden');
            }
        }

        function toggleTheme() {
            isDark = !isDark;
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
            applyTheme();
        }

        function toggleLanguage() {
            isHebrew = !isHebrew;
            localStorage.setItem('language', isHebrew ? 'he' : 'en');
            
            document.documentElement.dir = isHebrew ? 'rtl' : 'ltr';
            
            const langToggle = document.getElementById('langToggle');
            if (langToggle) {
                langToggle.textContent = isHebrew ? 'en' : 'ע';
            }
            
            const enTexts = document.querySelectorAll('.en-text');
            const heTexts = document.querySelectorAll('.he-text');
            
            if (isHebrew) {
                enTexts.forEach(el => el.classList.add('hidden'));
                heTexts.forEach(el => el.classList.remove('hidden'));
            } else {
                enTexts.forEach(el => el.classList.remove('hidden'));
                heTexts.forEach(el => el.classList.add('hidden'));
            }
        }

        async function loadDownloadCount() {
            try {
                const response = await fetch('download-count.json');
                const data = await response.json();
                const downloadStats = document.getElementById('downloadStats');
                if (downloadStats && data.count) {
                    downloadStats.innerHTML = `+${data.count.toLocaleString()} <span class="en-text">Downloads</span><span class="he-text ${isHebrew ? '' : 'hidden'}">הורדות</span>`;
                }
            } catch (error) {
                console.log('Could not load download count');
            }
        }

        function toggleAlternatives() {
            const content = document.getElementById('alternativesContent');
            const button = content.previousElementSibling;
            const isHidden = content.style.display === 'none' || !content.style.display;
            
            content.style.display = isHidden ? 'block' : 'none';
            button.classList.toggle('expanded', isHidden);
            
            const enText = button.querySelector('.en-text');
            const heText = button.querySelector('.he-text');
            
            if (isHidden) {
                enText.textContent = 'Hide options';
                heText.textContent = 'הסתר אפשרויות';
            } else {
                enText.textContent = 'More options';
                heText.textContent = 'אפשרויות נוספות';
            }
        }

        function togglePlatforms() {
            const content = document.getElementById('platformsContent');
            const button = content.previousElementSibling;
            const isHidden = content.style.display === 'none' || !content.style.display;
            
            content.style.display = isHidden ? 'block' : 'none';
            button.classList.toggle('expanded', isHidden);
            
            const enText = button.querySelector('.en-text');
            const heText = button.querySelector('.he-text');
            
            if (isHidden) {
                enText.textContent = 'Hide platforms';
                heText.textContent = 'הסתר פלטפורמות';
            } else {
                enText.textContent = 'Other platforms';
                heText.textContent = 'פלטפורמות אחרות';
            }
        }

        function toggleDatabase() {
            const content = document.getElementById('databaseContent');
            const button = content.previousElementSibling;
            const isHidden = content.style.display === 'none' || !content.style.display;
            
            content.style.display = isHidden ? 'block' : 'none';
            button.classList.toggle('expanded', isHidden);
            
            const enText = button.querySelector('.en-text');
            const heText = button.querySelector('.he-text');
            
            if (isHidden) {
                enText.textContent = 'Hide database';
                heText.textContent = 'הסתר מסד נתונים';
            } else {
                enText.textContent = 'Offline database';
                heText.textContent = 'מסד נתונים אופליין';
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            updateDownloadUI(); // Initialize platform detection
            applyTheme();
            loadDownloadCount();
            
            // Initialize expandable sections as hidden
            document.getElementById('alternativesContent').style.display = 'none';
            document.getElementById('platformsContent').style.display = 'none';
            document.getElementById('databaseContent').style.display = 'none';
            
            if (isHebrew) {
                document.documentElement.dir = 'rtl';
                document.getElementById('langToggle').textContent = 'en';
                
                document.querySelectorAll('.en-text').forEach(el => el.classList.add('hidden'));
                document.querySelectorAll('.he-text').forEach(el => el.classList.remove('hidden'));
            }
        });

        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', function(e) {
            if (!localStorage.getItem('theme')) {
                isDark = e.matches;
                applyTheme();
            }
        });
    </script>
</body>
</html>
